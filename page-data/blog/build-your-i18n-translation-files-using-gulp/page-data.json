{"componentChunkName":"component---src-templates-post-js","path":"/blog/build-your-i18n-translation-files-using-gulp","webpackCompilationHash":"aea8917325c902824bd5","result":{"data":{"file":{"childMarkdownRemark":{"html":"<p>From one hand, i want to have a flexible and dynamic source files for my app I18n/translations.\n<a href=\"http://rubyonrails.org/\">ROR</a> have a great I18n source structure that split you translations to many files and i want to adopt it in my <a href=\"https://angularjs.org/\">angularjs</a> project.\nFrom the other hand, serving  so many translation files to the end user can be a bad idea, i prefer to serve only one file with the specific locale that the user want.</p>\n<p>The goal is to have a source folder with all the translation files, then use <a href=\"http://gulpjs.com/\">gulp</a> to build a destination folder.</p>\n<p>The source folder contain list of folder, named as the locale name (<code class=\"language-text\">en-US</code>) and contain all the translations for this specific locale.</p>\n<h2>Source folder</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">locales\n├── en-US\n│   ├── country.json\n│   ├── dashboard.json\n│   ├── dashboard.state1.json\n│   ├── dashboard.state2.json\n│   ├── language.json\n│   ├── layout.json\n│   ├── login.json\n│   └── utils.json\n├── fr-FR\n│   ├── country.json\n│   ├── dashboard.json\n│   ├── dashboard.state1.json\n│   ├── dashboard.state2.json\n│   ├── layout.json\n│   ├── login.json\n│   └── utils.json\n└── he-IL\n    ├── country.json\n    ├── dashboard.json\n    ├── dashboard.state1.json\n    ├── dashboard.state2.json\n    ├── layout.json\n    ├── login.json\n    └── utils.json\n\n<span class=\"token number\">3</span> directories, <span class=\"token number\">22</span> files</code></pre></div>\n<h3>Source file</h3>\n<p>locales/en-US/country.json</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"country\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"navbarTitle\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"World Countries\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"list\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"pageTitle\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"World Countries\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name in english\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"nativeName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Name in native language\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"capital\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Capital\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"region\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Region\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"subregion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Sub Region\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"population\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Population\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"timezones\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Timezones\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"altSpellings\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Spellings\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"currencies\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Currencies\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"languages\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Languages\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"translations\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Translations\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"borders\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Borders\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>locales/en-US/dashboard.json</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dashboard\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dashboard\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"navbarTitle\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Dashboard\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>locales/en-US/dashboard.state1.json</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"dashboard\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"state1\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"paragraph1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"This is the a paragraph for state number one.\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"navbarTitle\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"state 1\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Destination folder</h2>\n<p>The destination folder will contain json file for each locale.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">locales\n├── en-US.json\n├── fr-FR.json\n└── he-IL.json\n\n<span class=\"token number\">0</span> directories, <span class=\"token number\">3</span> files</code></pre></div>\n<h2>The Gulp Task</h2>\n<p>First we need to make sure that we have <a href=\"http://gulpjs.com/\">gulp</a> globally installed:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g gulp</code></pre></div>\n<p>Then, install the task <a href=\"https://www.npmjs.com/\">npm</a> dependencies (remember that they are <strong>development dependencies</strong>):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev path streamqueue gulp-load-plugins gulp-extend</code></pre></div>\n<h3>The task source code</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// dependencies</span>\n    <span class=\"token keyword\">var</span> gulp          <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> path          <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> streamqueue   <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'streamqueue'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">var</span> plugins       <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'gulp-load-plugins'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token comment\">/**\n    * Task Settings\n    */</span>\n    <span class=\"token keyword\">var</span> avilableLocales <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'en-US'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'fr-FR'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'he-IL'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> localesSourcePattern <span class=\"token operator\">=</span> <span class=\"token string\">'config/locales/xxlocalexx/*.json'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">var</span> targetDir <span class=\"token operator\">=</span> <span class=\"token string\">'dist/locales'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n    * build each avilable locale (from localesSourcePattern)\n    * to his own json fle (en-US.json) at the target dir\n    */</span>\n    gulp<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token string\">'build:locales'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">buildLocalesQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>gulp<span class=\"token punctuation\">.</span><span class=\"token function\">dest</span><span class=\"token punctuation\">(</span>targetDir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// build each avilable locale</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">buildLocalesQueue</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Prepare the stream queue</span>\n        <span class=\"token keyword\">var</span> localesQueue <span class=\"token operator\">=</span> <span class=\"token function\">streamqueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> objectMode<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// For each avilable locales</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> avilableLocales<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Build the local and add to the stream queue</span>\n            localesQueue<span class=\"token punctuation\">.</span><span class=\"token function\">queue</span><span class=\"token punctuation\">(</span>\n                <span class=\"token function\">buildLocale</span><span class=\"token punctuation\">(</span>avilableLocales<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">return</span> localesQueue<span class=\"token punctuation\">.</span><span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Combine all the source locale files to one dist locale file</span>\n    <span class=\"token keyword\">function</span> <span class=\"token function\">buildLocale</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">locale</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> localePattern <span class=\"token operator\">=</span> localesSourcePattern<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/xxlocalexx/g</span><span class=\"token punctuation\">,</span> locale<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> gulp<span class=\"token punctuation\">.</span><span class=\"token function\">src</span><span class=\"token punctuation\">(</span>localePattern<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>plugins<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span>locale <span class=\"token operator\">+</span> <span class=\"token string\">'.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Using the task</h3>\n<p>just run in your terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gulp build:locales</code></pre></div>\n<p>result:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span><span class=\"token number\">10</span>:01:11<span class=\"token punctuation\">]</span> Using gulpfile ~/develop/angular/angular-full-seed/gulpfile.js\n<span class=\"token punctuation\">[</span><span class=\"token number\">10</span>:01:11<span class=\"token punctuation\">]</span> Starting <span class=\"token string\">'build:locales'</span><span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">[</span><span class=\"token number\">10</span>:01:11<span class=\"token punctuation\">]</span> Finished <span class=\"token string\">'build:locales'</span> after <span class=\"token number\">94</span> ms</code></pre></div>\n<p>Now you can run this task by its own or use it as a sub task for your main build task.</p>","frontmatter":{"title":"Build your I18n translation files using gulp"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"name":"2016-01-22-build-your-i18n-translation-files-using-gulp","date":"2016-01-22","postPath":"/blog/build-your-i18n-translation-files-using-gulp","postUrl":"https://sharvit.github.io/blog/build-your-i18n-translation-files-using-gulp"}}}