{"componentChunkName":"component---src-templates-post-tsx","path":"/blog/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales","result":{"data":{"file":{"name":"2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales","childMarkdownRemark":{"html":"<p>The goal is to write a smart contract that will allow entrepreneurs to crowdfund a project by selling NFTs, so if the goal isnâ€™t reached, the NFT holders can get their money back by burning their NFTs.</p>\n<p>Without smart contracts, such an implementation would be complicated and limited as it would require dealing with credit cards, bank accounts, and complex refunds.\nWith smart contracts, anyone can write and deploy simple contracts and raise funds to create new projects.</p>\n<p>I was starting with the openzeppelin wizard and created a smiple smart ERC721 contract:\n<a href=\"https://wizard.openzeppelin.com/#erc721\">https://wizard.openzeppelin.com/#erc721</a></p>\n<h2>Constants</h2>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token comment\">// Token Price</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MINT_PRICE <span class=\"token operator\">=</span> <span class=\"token number\">0.4</span> ether<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Token price for the extra supply</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MINT_EXTRA_PRICE <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span> ether<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The minimum amount of tokens that should be sold.</span>\n<span class=\"token comment\">// This is the goal, if not reached, token holders can ask for refund.</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MIN_SUPPLY <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Extra supply to be minted for the higer price</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> EXTRA_SUPPLY <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Duration in seconds of the minting phase</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MINTING_DURATION <span class=\"token operator\">=</span> <span class=\"token number\">2</span> weeks<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Maximum to mint per transaction</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MAX_MINT_PER_TRANSACTION <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Private variables</h2>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token comment\">//Indicator if sale is started and when started</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">private</span> _saleStartedAt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// The amount of tokens that already minted</span>\n<span class=\"token builtin\">uint256</span> <span class=\"token keyword\">private</span> _supplyMinted <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// TokenId counter</span>\nCounters<span class=\"token punctuation\">.</span>Counter <span class=\"token keyword\">private</span> _tokenIdCounter<span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Private mint function</h2>\n<p>The <code class=\"language-text\">_mintMulti</code> is internal, so it can only be used internaly by other functions.\nThis functions will recive an address that will recive the tokens and amount of tokens to mint.</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token keyword\">function</span> <span class=\"token function\">_mintMulti</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> to<span class=\"token punctuation\">,</span> <span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">internal</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// run {amount} times</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> amount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// get the token-id to use</span>\n    <span class=\"token builtin\">uint256</span> tokenId <span class=\"token operator\">=</span> _tokenIdCounter<span class=\"token punctuation\">.</span><span class=\"token function\">current</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// increment for the next usage</span>\n    _tokenIdCounter<span class=\"token punctuation\">.</span><span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// mint a new token</span>\n    <span class=\"token function\">_safeMint</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">,</span> tokenId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// increment the _supplyMinted</span>\n    _supplyMinted <span class=\"token operator\">=</span> _supplyMinted<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Public functions</h2>\n<h3><code class=\"language-text\">startSale</code></h3>\n<p>Allows the owner to start the sale, uses the <code class=\"language-text\">onlyOwner</code> modifier to require the caller to be the owner.</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token keyword\">function</span> <span class=\"token function\">startSale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> onlyOwner <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isSaleStarted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sale already started\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  _saleStartedAt <span class=\"token operator\">=</span> block<span class=\"token punctuation\">.</span>timestamp<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3><code class=\"language-text\">Mint</code></h3>\n<p>Allows users to mint tokens.</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token keyword\">function</span> <span class=\"token function\">mint</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isSaleActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sale is not active\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>amount <span class=\"token operator\">&lt;=</span> MAX_MINT_PER_TRANSACTION<span class=\"token punctuation\">,</span> <span class=\"token string\">\"You can only mint 10 tokens at a time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">supplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> MIN_SUPPLY<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Can not mint more than the max supply\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">>=</span> amount <span class=\"token operator\">*</span> MINT_PRICE<span class=\"token punctuation\">,</span> <span class=\"token string\">\"You have not sent enough ETH\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">_mintMulti</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3><code class=\"language-text\">mintExtra</code></h3>\n<p>Allows users to mint the extra tokens.</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token keyword\">function</span> <span class=\"token function\">mintExtra</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isSaleActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sale is not active\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>amount <span class=\"token operator\">&lt;=</span> MAX_MINT_PER_TRANSACTION<span class=\"token punctuation\">,</span> <span class=\"token string\">\"You can only mint 10 tokens at a time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">supplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> MIN_SUPPLY <span class=\"token operator\">+</span> EXTRA_SUPPLY<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Can not mint more than the max supply\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">>=</span> amount <span class=\"token operator\">*</span> MINT_EXTRA_PRICE<span class=\"token punctuation\">,</span> <span class=\"token string\">\"You have not sent enough ETH\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isMinSupplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"The normal supply has not minted yet\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">_mintMulti</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3><code class=\"language-text\">withdraw</code></h3>\n<p>Allows the owner to withdraw the funds, uses the <code class=\"language-text\">onlyOwner</code> modifier to require the caller to be the owner.</p>\n<p>It requires the goal to be reached, unless, the owner cannot withdraw the funds.</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token keyword\">function</span> <span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> onlyOwner <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isMinSupplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Goal has not been reached, cannot withdraw funds\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token builtin\">uint256</span> balance <span class=\"token operator\">=</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">payable</span><span class=\"token punctuation\">(</span><span class=\"token function\">owner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>balance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3><code class=\"language-text\">getRefund</code></h3>\n<p>Allows token holders to get a refund if the goal has not reached.</p>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token comment\">/**\n * Allows token holders to get a refund if the goal has not reached\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getRefund</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isSaleFinished</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sale is still active\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isMinSupplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Goal has been reached! Cannot refund token fee\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// get user token balance</span>\n  <span class=\"token builtin\">uint256</span> tokensAmount <span class=\"token operator\">=</span> <span class=\"token function\">balanceOf</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>tokensAmount <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Not a token holder\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// a list of user token-ids</span>\n  <span class=\"token builtin\">uint256</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">memory</span> userTokens <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">uint256</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>tokensAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// get all token-ids own by the user</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> index <span class=\"token operator\">&lt;</span> tokensAmount<span class=\"token punctuation\">;</span> index<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">uint256</span> tokenId <span class=\"token operator\">=</span> <span class=\"token function\">tokenOfOwnerByIndex</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    userTokens<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> tokenId<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// pay the user back</span>\n  <span class=\"token keyword\">payable</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>tokensAmount <span class=\"token operator\">*</span> MINT_PRICE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// burn the user tokens</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> index <span class=\"token operator\">&lt;</span> tokensAmount<span class=\"token punctuation\">;</span> index<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">_burn</span><span class=\"token punctuation\">(</span>userTokens<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Full Source Code</h2>\n<div class=\"gatsby-highlight\" data-language=\"solidity\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-solidity line-numbers\"><code class=\"language-solidity\"><span class=\"token comment\">// SPDX-License-Identifier: MIT</span>\n<span class=\"token keyword\">pragma</span> <span class=\"token keyword\">solidity</span> <span class=\"token operator\">^</span><span class=\"token version number\">0.8.4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/token/ERC721/ERC721.sol\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/access/Ownable.sol\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/utils/Counters.sol\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/utils/Address.sol\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"@openzeppelin/contracts/utils/math/SafeMath.sol\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">contract</span> <span class=\"token class-name\">MyCoolProject</span> <span class=\"token keyword\">is</span> ERC721<span class=\"token punctuation\">,</span> ERC721Enumerable<span class=\"token punctuation\">,</span> Ownable <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">using</span> <span class=\"token class-name\">Address</span> <span class=\"token keyword\">for</span> <span class=\"token builtin\">address</span> <span class=\"token keyword\">payable</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">using</span> <span class=\"token class-name\">SafeMath</span> <span class=\"token keyword\">for</span> <span class=\"token builtin\">uint256</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">using</span> <span class=\"token class-name\">Counters</span> <span class=\"token keyword\">for</span> Counters<span class=\"token punctuation\">.</span>Counter<span class=\"token punctuation\">;</span>\n    \n  <span class=\"token comment\">/**\n   * Token Price\n   */</span>\n  <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MINT_PRICE <span class=\"token operator\">=</span> <span class=\"token number\">0.4</span> ether<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Token price for the extra supply\n   */</span>\n  <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MINT_EXTRA_PRICE <span class=\"token operator\">=</span> <span class=\"token number\">0.5</span> ether<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * The minimum amount of tokens that should be sold.\n   * This is the goal of the current phase,\n   * if not reached, token holders can ask for refund.\n   */</span>\n  <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MIN_SUPPLY <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Extra supply to be minted for the higer price\n   */</span>\n  <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> EXTRA_SUPPLY <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Duration in seconds of the minting phase\n   */</span>\n  <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MINTING_DURATION <span class=\"token operator\">=</span> <span class=\"token number\">2</span> weeks<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Maximum to mint per transaction\n   */</span>\n  <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">constant</span> MAX_MINT_PER_TRANSACTION <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Indicator if sale is started and when started</span>\n  <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">private</span> _saleStartedAt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// The amount of tokens that already minted</span>\n  <span class=\"token builtin\">uint256</span> <span class=\"token keyword\">private</span> _supplyMinted <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// tokenId counter</span>\n  Counters<span class=\"token punctuation\">.</span>Counter <span class=\"token keyword\">private</span> _tokenIdCounter<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token function\">ERC721</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MyCoolProject\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"MCP\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  \n  <span class=\"token comment\">/**\n   * Amount of the supply that already been minted by users\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">supplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">view</span> <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> _supplyMinted<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Timestamp of the time the sale has started\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">saleStartedAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">view</span> <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> _saleStartedAt<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Boolean indicator, does the sale started?\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">isSaleStarted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">view</span> <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">saleStartedAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Boolean indicator, does the sale finished?\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">isSaleFinished</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">view</span> <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">isSaleStarted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> block<span class=\"token punctuation\">.</span>timestamp <span class=\"token operator\">></span> <span class=\"token function\">saleStartedAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> MINTING_DURATION<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Boolean indicator, does the sale active?\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">isSaleActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">view</span> <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">isSaleStarted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> block<span class=\"token punctuation\">.</span>timestamp <span class=\"token operator\">&lt;=</span> <span class=\"token function\">saleStartedAt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> MINTING_DURATION<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Boolean indicator, does the minimum supply minted?\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">isMinSupplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">view</span> <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">supplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> MIN_SUPPLY<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Boolean indicator, does the extra supply minted?\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">isExtraSupplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">view</span> <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">supplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> MIN_SUPPLY <span class=\"token operator\">+</span> EXTRA_SUPPLY<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Allows the owner to start the sale\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">startSale</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> onlyOwner <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isSaleStarted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sale already started\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    _saleStartedAt <span class=\"token operator\">=</span> block<span class=\"token punctuation\">.</span>timestamp<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Allows everyone to mint tokens\n   *\n   * uint256 [amount] amount of tokens to mint\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">mint</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isSaleActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sale is not active\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>amount <span class=\"token operator\">&lt;=</span> MAX_MINT_PER_TRANSACTION<span class=\"token punctuation\">,</span> <span class=\"token string\">\"You can only mint 10 tokens at a time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">supplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> MIN_SUPPLY<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Can not mint more than the max supply\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">>=</span> amount <span class=\"token operator\">*</span> MINT_PRICE<span class=\"token punctuation\">,</span> <span class=\"token string\">\"You have not sent enough ETH\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">_mintMulti</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Allows everyone to mint the extra tokens\n   *\n   * uint256 [amount] amount of extra tokens to mint\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">mintExtra</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">payable</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isSaleActive</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sale is not active\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>amount <span class=\"token operator\">&lt;=</span> MAX_MINT_PER_TRANSACTION<span class=\"token punctuation\">,</span> <span class=\"token string\">\"You can only mint 10 tokens at a time\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">supplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;=</span> MIN_SUPPLY <span class=\"token operator\">+</span> EXTRA_SUPPLY<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Can not mint more than the max supply\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>value <span class=\"token operator\">>=</span> amount <span class=\"token operator\">*</span> MINT_EXTRA_PRICE<span class=\"token punctuation\">,</span> <span class=\"token string\">\"You have not sent enough ETH\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isMinSupplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"The normal supply has not minted yet\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">_mintMulti</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Allows the owner to withdraw the funds\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">withdraw</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> onlyOwner <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isMinSupplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Goal has not been reached, cannot withdraw funds\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token builtin\">uint256</span> balance <span class=\"token operator\">=</span> <span class=\"token builtin\">address</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>balance<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">payable</span><span class=\"token punctuation\">(</span><span class=\"token function\">owner</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>balance<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * Allows token holders to get a refund if the goal has not reached\n   */</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">getRefund</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">public</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token function\">isSaleFinished</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Sale is still active\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isMinSupplyMinted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Goal has been reached! Cannot refund token fee\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// get user token balance</span>\n    <span class=\"token builtin\">uint256</span> tokensAmount <span class=\"token operator\">=</span> <span class=\"token function\">balanceOf</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">require</span><span class=\"token punctuation\">(</span>tokensAmount <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Not a token holder\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// a list of user token-ids</span>\n    <span class=\"token builtin\">uint256</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">memory</span> userTokens <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">uint256</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span>tokensAmount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// get all token-ids own by the user</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> index <span class=\"token operator\">&lt;</span> tokensAmount<span class=\"token punctuation\">;</span> index<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">uint256</span> tokenId <span class=\"token operator\">=</span> <span class=\"token function\">tokenOfOwnerByIndex</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      userTokens<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> tokenId<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// pay the user back</span>\n    <span class=\"token keyword\">payable</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">.</span>sender<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">transfer</span><span class=\"token punctuation\">(</span>tokensAmount <span class=\"token operator\">*</span> MINT_PRICE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// burn the user tokens</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> index <span class=\"token operator\">&lt;</span> tokensAmount<span class=\"token punctuation\">;</span> index<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">_burn</span><span class=\"token punctuation\">(</span>userTokens<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">function</span> <span class=\"token function\">_mintMulti</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> to<span class=\"token punctuation\">,</span> <span class=\"token builtin\">uint256</span> amount<span class=\"token punctuation\">)</span> <span class=\"token keyword\">internal</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">uint256</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> amount<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">uint256</span> tokenId <span class=\"token operator\">=</span> _tokenIdCounter<span class=\"token punctuation\">.</span><span class=\"token function\">current</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      _tokenIdCounter<span class=\"token punctuation\">.</span><span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      \n      <span class=\"token function\">_safeMint</span><span class=\"token punctuation\">(</span>to<span class=\"token punctuation\">,</span> tokenId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      _supplyMinted <span class=\"token operator\">=</span> _supplyMinted<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// The following functions are overrides required by Solidity.</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">_beforeTokenTransfer</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">address</span> <span class=\"token keyword\">from</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">address</span> to<span class=\"token punctuation\">,</span> <span class=\"token builtin\">uint256</span> tokenId<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">internal</span>\n    <span class=\"token function\">override</span><span class=\"token punctuation\">(</span>ERC721<span class=\"token punctuation\">,</span> ERC721Enumerable<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    super<span class=\"token punctuation\">.</span><span class=\"token function\">_beforeTokenTransfer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">from</span><span class=\"token punctuation\">,</span> to<span class=\"token punctuation\">,</span> tokenId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">function</span> <span class=\"token function\">supportsInterface</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">bytes4</span> interfaceId<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">public</span>\n    <span class=\"token keyword\">view</span>\n    <span class=\"token function\">override</span><span class=\"token punctuation\">(</span>ERC721<span class=\"token punctuation\">,</span> ERC721Enumerable<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">returns</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> super<span class=\"token punctuation\">.</span><span class=\"token function\">supportsInterface</span><span class=\"token punctuation\">(</span>interfaceId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","excerpt":"The goal is to write a smart contract that will allow entrepreneurs to crowdfund a project by selling NFTs, so if the goal isnâ€™t reached, the NFT holders can get their money back by burning their NFTs. Without smart contracts, such an implementation would be complicated andâ€¦","frontmatter":{"title":"Writing smart contracts using solidity to crowdfund a project by NFT sales","coverImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","backgroundColor":"#080818","images":{"fallback":{"src":"/static/1bda86e81cf2174bfc39a0e8b4b14bb2/52a49/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.jpg","srcSet":"/static/1bda86e81cf2174bfc39a0e8b4b14bb2/5f965/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.jpg 750w,\n/static/1bda86e81cf2174bfc39a0e8b4b14bb2/76f9a/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.jpg 1080w,\n/static/1bda86e81cf2174bfc39a0e8b4b14bb2/54fb8/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.jpg 1366w,\n/static/1bda86e81cf2174bfc39a0e8b4b14bb2/52a49/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.jpg 1680w","sizes":"100vw"},"sources":[{"srcSet":"/static/1bda86e81cf2174bfc39a0e8b4b14bb2/ee7ce/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.webp 750w,\n/static/1bda86e81cf2174bfc39a0e8b4b14bb2/819dc/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.webp 1080w,\n/static/1bda86e81cf2174bfc39a0e8b4b14bb2/7b8ce/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.webp 1366w,\n/static/1bda86e81cf2174bfc39a0e8b4b14bb2/6f2a1/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales.webp 1680w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.5}}}}}}},"pageContext":{"id":"f549b5a9-f929-58b5-9d09-571f1730514f","postPath":"/blog/2022-02-26-writing-smart-contracts-using-solidity-to-crowdfund-a-project-by-nft-sales"}},"staticQueryHashes":["1421987612","2375201890","2545220355","282316431","338777631","3904166403","400598487","472951252"]}